# Context Snapshot - WhaleVault V3 Implementation Kickoff
**Date:** 2026-01-27 14:30
**Context Usage:** 363% (critical - must compact)

## Status
- PRD: ✅ Updated to V3
- Architecture doc: ✅ Updated to V3
- Implementation plan: ✅ Written at `/Users/MAC/.claude/plans/smooth-meandering-candle.md`
- Task list: ✅ 17 tasks created with dependency graph
- Execution: Starting Phase 0

## Task List (17 tasks)
### Phase 0 (parallel, no deps):
- #1: Task 0.1 — Supabase Project Setup (DevOps)
- #2: Task 0.2 — Jupiter API Research (Research)
- #3: Task 0.3 — Rename Unshield → Stealth Withdraw (UI/Frontend)
- #4: Task 3.4 — USDC Coming Soon Badge (UI/Frontend)

### Phase 1 (sequential, critical path):
- #5: Task 1.1 — Encryption Module (Implementation) — no deps
- #6: Task 1.2 — Supabase Client & Vault Storage (Implementation) — blocked by #1, #5
- #7: Task 1.3 — Integrate Backup into Position Store (Implementation) — blocked by #6
- #8: Task 1.4 — Backup Status UI (UI/Frontend) — blocked by #7

### Phase 2 (parallel with Phase 1):
- #9: Task 2.1 — Jupiter Backend Service (Implementation) — blocked by #2
- #10: Task 2.2 — Swap API Endpoints (Implementation) — blocked by #9
- #11: Task 2.3 — Swap Frontend Hook (Implementation) — blocked by #10
- #12: Task 2.4 — Private Swap Page (UI/Frontend) — blocked by #11

### Phase 3 (mixed deps):
- #13: Task 3.1 — Privacy Delay Toggle (Implementation) — blocked by #7
- #14: Task 3.2 — Enhanced History Page (UI/Frontend) — blocked by #3, #11
- #15: Task 3.3 — Export/Import Receipts (Implementation) — blocked by #5

### Phase 4 (final):
- #16: Task 4.1 — Security Audit (Security) — blocked by #7, #10, #13, #15
- #17: Task 4.2 — E2E Verification (Testing) — blocked by #16

## Codebase State (from Research agents)
### Frontend:
- Pages: Landing(/), Dashboard, Shield, Unshield, History
- Hooks: useShield, useUnshield, useWallet, usePools, useProofStatus, useConfetti
- Stores (Zustand): positions (localStorage), transactions (localStorage), wallet
- Lib: api.ts, commitment.ts, constants.ts, errors.ts, polling.ts, secret-derivation.ts, transaction.ts, utils.ts, verification.ts
- Components: Header, Button, Card, Skeleton, ErrorBoundary, ConnectButton, WalletProvider, ProofAnimation, DenominationSelector, PrivacyWarning
- Secret derivation: HKDF-SHA256 from wallet signature + nonce
- Positions in localStorage, secrets re-derived from stored nonce

### Backend:
- Routes: shield, unshield, proof, pool, health, relay, commitment
- Services: veil_service, pool_service, proof_generator (Groth16 via Node.js), relayer_service
- NO swap/Jupiter code exists
- Relayer: loads keypair from JSON, fee 30bps, calls veil SDK
- Proof queue: in-memory async job queue
- Config: denominations 1/10/100/1K/10K SOL

## Key Design Decisions
- Supabase: frontend-only access, backend never touches position data
- Encryption: AES-256-GCM, key = SHA-256(wallet signature of "WhaleVault-v1")
- Wallet hash: SHA-256(pubkey) for Supabase lookup
- Privacy delay: client-side enforcement, set at shield time
- Swap flow: proof gen → relayer unshields → Jupiter swap → send token to recipient
- Nav: Dashboard | Shield | Stealth Withdraw | Private Swap | History
- Internal code names stay "unshield" — only UI text changes

## Next Steps
Execute Phase 0 tasks in parallel: 0.1 (Supabase), 0.2 (Jupiter research), 0.3 (rename), 3.4 (USDC badge)
Also start Task 1.1 (encryption module) since it has no dependencies
