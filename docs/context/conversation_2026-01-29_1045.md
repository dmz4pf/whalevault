# Context Snapshot - WhaleVault Frontend
**Date:** 2026-01-29 10:45
**Context Usage:** 151.8%

## Current Task
Implementing privacy level UI with fixed intervals and enhanced unshield flow with action options.

## Key Decisions Made
- **Privacy Level**: Fixed intervals (Instant, 1h, 6h, 12h, 24h, Custom) instead of random ranges
- **Unshield Actions**: Three options - Send Privately (recommended), Swap Privately, Back to My Wallet (de-emphasized with warning)
- **Time Delays**: Set at shield time, enforced at unshield time with countdown display
- **Splitting to Multiple Addresses**: Moved to "Coming Soon" - requires circuit changes

## Implementation State
- [x] Updated `PrivacyDelay.tsx` with fixed intervals (Instant, 1h, 6h, 12h, 24h, Custom)
- [x] Updated `unshield/page.tsx` with action selector (Send/Swap/Wallet)
- [x] Added privacy warnings for "Back to My Wallet" option
- [x] Added locked position display with countdown
- [x] TypeScript compiles successfully
- [ ] Test the UI in browser
- [ ] Integrate with backend intent queue (future)

## Files Modified This Session
- `frontend/components/shield/PrivacyDelay.tsx` - Complete rewrite with fixed intervals
- `frontend/app/unshield/page.tsx` - Added action selector, privacy warnings, locked positions

## Architecture Summary

### Shield Flow
1. User selects denomination (1, 10, 100, 1K, 10K SOL)
2. User selects privacy level (Instant, 1h, 6h, 12h, 24h, Custom)
3. User signs transaction → ZK commitment created
4. Position stored with `delayUntil` timestamp

### Unshield Flow
1. User selects shielded position (locked positions show countdown)
2. User chooses action:
   - **Send Privately** → Enter recipient → ZK proof → Relayer submits
   - **Swap Privately** → Redirect to /private-swap
   - **Back to My Wallet** → Warning shown → ZK proof → Relayer submits to own wallet
3. Relayer signs and submits (user wallet never signs)

### Key Files
- `/frontend/components/shield/PrivacyDelay.tsx` - Privacy level selector
- `/frontend/app/shield/page.tsx` - Shield page
- `/frontend/app/unshield/page.tsx` - Unshield with action options
- `/frontend/app/private-swap/page.tsx` - Swap flow (Raydium devnet, Jupiter mainnet)
- `/frontend/hooks/useUnshield.ts` - Unshield hook with relayer integration
- `/backend/api/routes/swap.py` - Swap endpoints
- `/backend/services/relayer_service.py` - Relayer that signs transactions

### Privacy Model
- Relayer: `2rP2h5D28o3naqHNcND36zFkGQ5JBaouxG6fzgRjhvvC`
- Program: `3qhVPvz8T1WiozCLEfhUuv8WZHDPpEfnAzq2iSatULc7`
- User wallet never signs unshield tx → True privacy
- Fixed denominations create anonymity sets

## Next Steps
1. Test UI in browser
2. Implement intent queue for scheduled unshields (backend)
3. Add stealth addresses (future enhancement)
4. Add "Coming Soon" UI for splitting feature

## Blockers / Open Questions
- None currently
