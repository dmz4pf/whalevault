# Context Snapshot - WhaleVault Token-2022 Support Complete
**Date:** 2026-01-30 08:20
**Project:** WhaleVault Private Swap

## Current Task
Adding privacy delay to swap section + auto-navigate from withdraw to swap with pre-selected position.

## Completed This Session
1. **Token-2022 Support** - Full implementation complete:
   - `get_token_program_for_mint()` - Detects SPL Token vs Token-2022
   - `derive_ata()` - Uses correct token program in ATA derivation
   - `create_ata_instruction()` - Creates ATA with correct program
   - `create_spl_transfer_instruction()` - Uses `transfer_checked` (opcode 12) for Token-2022
   - `transfer_tokens_to_recipient()` - Passes mint and decimals for Token-2022
   - Main swap flow detects token program and decimals, passes throughout

2. **Privacy Verified** - User's wallet NEVER appears in swap/transfer transactions

## Key Technical Details
- Token-2022 requires `transfer_checked` instruction, not basic `transfer`
- `transfer_checked` needs: source, mint, dest, owner, amount (u64), decimals (u8)
- Decimals read from mint account data at byte offset 44

## Files Modified
- `backend/api/routes/swap.py` - Full Token-2022 support

## Next Task (Current)
User wants:
1. Add privacy delay animation to swap section (like withdraw has)
2. When clicking "swap to token" on withdraw page â†’ navigate to swap page with position pre-selected
3. Scrolling animation to skip pool selection step

## Relayer Wallet
`2rP2h5D28o3naqHNcND36zFkGQ5JBaouxG6fzgRjhvvC`

## Stuck Tokens (from failed transfer before fix)
- ~974 billion units of `EdibWH8u5rmCGmbU1jBBEJtnk3Qo7JdU71FAzkWu2dhH`
- In relayer's ATA from successful swap, transfer failed before Token-2022 fix
